# MobileGNSS-SPP

## An EKF-based SPP system optimized for smartphone
MobileGNSS-SPP是一个基于RTKLIB的改进SPP项目，其主要针对智能手机，该项目尤其针对某一款手机GNSS芯片（其型号暂时无从得知）进行了优化，不过其中的优化思路具备一定的通用性和启发性，因此也可以用于其他GNSS芯片。该项目并非完全关注算法原理和框架的先进性，而是关注工程化以及不同场景的算法鲁棒性，因此本项目可以视为从开源代码到工程化方案的路线图。

### 算法优化项
主要关注的文件：
- rtklib_src/pntpos.c

有效的改进：
- M估计（抗差，R调节）：使用迭代最小二乘求得权阵W，使用Huber作为核函数，不过需要对残差较大项进行截断处理；
- 零速修正；
- SNR加权模型：需要给多普勒也进行SNR加权；
- 伪距残差的多路径误差补偿（主要来自芯片的测试经验，而非特定的数学模型）；

不确定的改进：
- 自适应Q：一个谈不上专业的土法子，使用EKF预测的速度与RWLS的速度差值来构建Q中的速度协方差项；

启发项：
- costmin代价最小化（仅后处理）；

## 1. 程序编译与运行
### 1.1 编译环境
MobileGNSS-SPP项目使用CMake管理，理论上支持在Linux环境，MacOS环境和Windows环境下编译。不过建议优先选择Windows环境进行编译。

MobileGNSS-SPP编译成功后需要使用配置文件作为参数。程序调试时也需要添加命令行参数。

### 1.2 在Windows内编译
rnx2rtkp应用中包含一个msc的VS项目文件，可以直接使用VS打开，已经包含了基本的配置。

不过需要将配置修改为Release模式，并设置编译方式为WIN32，不然会出现问题。

程序最终运行前，需要在VS配置中设置命令参数，具体位置为配置-调试-命令参数，注意需要将配置栏也由Debug设置为Release，因为配置项默认为Release，输入如下的命令：

```shell
.\rnx2rtkp -x 0 -k ..\conf\rover.conf -o ..\..\..\data\01-opensky\data01\rover.pos ..\..\..\data\01-opensky\data01\rover.obs ..\..\..\data\01-opensky\data01\rover.nav
```

## 2. 使用MobileGNSS-SPP
### 2.1 测试数据
测试场景分类：  

| 测试场景 | 场景描述                    |
| ---- | --------------------------- |
| 开阔环境测试（高架环路）| 在高架桥面道路、城市外环路或环路等开阔且相对直线路段进行测试，这些路段通常具有良好的GNSS信号接收条件，适合测试设备在高速移动和无障碍环境下的性能。|
| 城市街道测试（树荫街道）| 在城市街道环境中进行测试，特别是有路边树木的街道，可能存在一定程度的GNSS信号遮挡。  |
| 复杂环境测试（市中心）  | 在市中心区域进行测试，通常有高楼大厦、密集建筑和复杂的交通环境，GNSS信号接收可能受到较大干扰。 |
| 遮挡环境测试（高架遮挡）| 在高架桥下或高架桥附近进行测试。高架桥的桥墩、桥面及周边建筑会对GNSS信号产生遮挡或反射，形成复杂的信号环境。 |
